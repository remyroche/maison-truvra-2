<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gérer les Commandes - Admin Maison Trüvra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="admin_styles.css">
</head>
<body class="bg-brand-cream text-brand-earth-brown font-inter">
    <div class="admin-layout">
<div id="admin-sidebar-placeholder"></div>

        <main class="admin-main-content">
            <header class="admin-main-header">
                <h1 class="text-3xl font-serif text-brand-near-black">Gestion des Commandes</h1>
            </header>

            <section class="p-6">
                <div class="admin-card p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                        <div>
                            <label for="order-search" class="form-label-admin text-xs">Rechercher (ID Commande, Email Client)</label>
                            <input type="text" id="order-search" class="form-input-admin text-sm p-2" placeholder="ID ou Email...">
                        </div>
                        <div>
                            <label for="order-status-filter" class="form-label-admin text-xs">Filtrer par Statut</label>
                            <select id="order-status-filter" class="form-select-admin text-sm p-2">
                                <option value="">Tous les statuts</option>
                                <option value="Pending">En attente</option>
                                <option value="Paid">Payée</option>
                                <option value="Shipped">Expédiée</option>
                                <option value="Delivered">Livrée</option>
                                <option value="Cancelled">Annulée</option>
                            </select>
                        </div>
                        <div>
                            <label for="order-date-filter" class="form-label-admin text-xs">Filtrer par Date</label>
                            <input type="date" id="order-date-filter" class="form-input-admin text-sm p-2">
                        </div>
                        <button id="apply-order-filters-button" class="btn-admin-primary text-sm py-2">Appliquer Filtres</button>
                    </div>
                </div>

                <div class="admin-card overflow-x-auto">
                    <h2 class="text-2xl font-serif text-brand-near-black p-6">Liste des Commandes</h2>
                    <table id="orders-table" class="admin-table">
                        <thead>
                            <tr>
                                <th scope="col">ID Commande</th>
                                <th scope="col">Client</th>
                                <th scope="col">Date</th>
                                <th scope="col">Total</th>
                                <th scope="col">Statut</th>
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="orders-table-body">
                            <tr><td colspan="6" class="text-center py-4">Chargement des commandes...</td></tr>
                        </tbody>
                    </table>
                    <div id="orders-pagination" class="p-4 text-center">
                        <span class="text-sm text-brand-warm-taupe">Pagination à implémenter</span>
                    </div>
                </div>

                <div id="order-detail-modal" class="admin-modal-overlay">
                    <div class="admin-modal-content max-w-3xl"> <h3 id="order-detail-modal-title" class="admin-modal-header">Détails de la Commande #<span id="modal-order-id"></span></h3>
                        <div id="order-detail-modal-body" class="space-y-4 text-sm max-h-[70vh] overflow-y-auto">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <p><strong>Date:</strong> <span id="modal-order-date"></span></p>
                                    <p><strong>Email Client:</strong> <span id="modal-order-customer-email"></span></p>
                                    <p><strong>Nom Client:</strong> <span id="modal-order-customer-name"></span></p>
                                </div>
                                <div>
                                    <p><strong>Statut Actuel:</strong> <span id="modal-order-current-status" class="font-semibold"></span></p>
                                    <p><strong>Montant Total:</strong> <span id="modal-order-total-amount" class="font-bold text-brand-classic-gold"></span></p>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="text-md font-semibold text-brand-near-black mt-3 mb-1">Adresse de Livraison</h4>
                                <address id="modal-order-shipping-address" class="not-italic bg-brand-cream p-3 rounded-md text-xs"></address>
                            </div>

                            <div>
                                <h4 class="text-md font-semibold text-brand-near-black mt-3 mb-1">Articles Commandés</h4>
                                <table class="w-full text-xs">
                                    <thead class="bg-brand-cream">
                                        <tr>
                                            <th class="p-2 text-left">Produit</th>
                                            <th class="p-2 text-left">Variante</th>
                                            <th class="p-2 text-center">Qté</th>
                                            <th class="p-2 text-right">Prix Unitaire</th>
                                            <th class="p-2 text-right">Sous-total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="modal-order-items-table-body">
                                        </tbody>
                                </table>
                            </div>

                            <div class="pt-4 border-t border-brand-cream">
                                <h4 class="text-md font-semibold text-brand-near-black mb-2">Mettre à Jour la Commande</h4>
                                <form id="update-order-status-form" class="space-y-3">
                                    <input type="hidden" id="update-order-id-hidden">
                                    <div>
                                        <label for="modal-order-new-status" class="form-label-admin text-xs">Nouveau Statut:</label>
                                        <select id="modal-order-new-status" class="form-select-admin text-sm p-2">
                                            <option value="Pending">En attente</option>
                                            <option value="Paid">Payée</option>
                                            <option value="Shipped">Expédiée</option>
                                            <option value="Delivered">Livrée</option>
                                            <option value="Cancelled">Annulée</option>
                                        </select>
                                    </div>
                                    <div id="shipping-info-fields" style="display:none;">
                                        <label for="modal-order-tracking-number" class="form-label-admin text-xs">N° de Suivi:</label>
                                        <input type="text" id="modal-order-tracking-number" class="form-input-admin text-sm p-2" placeholder="Optionnel">
                                        <label for="modal-order-carrier" class="form-label-admin text-xs mt-2">Transporteur:</label>
                                        <input type="text" id="modal-order-carrier" class="form-input-admin text-sm p-2" placeholder="Ex: Colissimo, Chronopost">
                                    </div>
                                    <button type="submit" class="btn-admin-primary text-sm py-2">Mettre à Jour Statut</button>
                                </form>
                            </div>
                             <div class="pt-4 border-t border-brand-cream">
                                <h4 class="text-md font-semibold text-brand-near-black mb-2">Notes Internes</h4>
                                <div id="modal-order-notes-history" class="max-h-24 overflow-y-auto bg-brand-cream p-2 rounded-md text-xs mb-2">
                                    <p class="italic text-brand-warm-taupe">Aucune note.</p>
                                </div>
                                <form id="add-order-note-form">
                                    <textarea id="modal-order-new-note" rows="2" class="form-textarea-admin text-sm p-2" placeholder="Ajouter une note..."></textarea>
                                    <button type="submit" class="btn-admin-secondary text-xs py-1.5 mt-2">Ajouter Note</button>
                                </form>
                            </div>
                        </div>
                        <div class="admin-modal-footer">
                            <button type="button" id="close-order-detail-modal-button" class="btn-admin-secondary">Fermer</button>
                        </div>
                    </div>
                </div>

            </section>
        </main>
    </div>
    <div id="admin-toast-container"><div id="admin-message-toast"><p id="admin-message-text"></p></div></div>
    
    <script>
        fetch('admin_sidebar.html')
            .then(response => response.text())
            .then(data => {
                document.getElementById('admin-sidebar-placeholder').innerHTML = data;
            });
    </script>
    <script src="../website/admin/js/admin_config.js"></script>
    <script src="../website/admin/js/admin_ui.js"></script>
    <script src="../website/admin/js/admin_api.js"></script>
    <script src="../website/admin/js/admin_auth.js"></script>
    <script src="../website/admin/js/admin_orders.js"></script>
    <script src="../website/admin/js/admin_main.js"></script>
</body>
</html>
